# AutoInject

AutoInject is an open source .NET library that enables automatic registration of services into the dependency injection container using attributes. Simply decorate your classes with the `[InjectService]` attribute and let AutoInject handle the rest.

## Features
- Attribute-based service registration
- Supports Singleton, Scoped, and Transient lifetimes
- Keyed and collection-based registration
- Works with Microsoft.Extensions.DependencyInjection
- Compatible with *.NET 5.0* and later

## Installation
Install the NuGet package:

```shell
dotnet add package RiseOn.AutoInject
```

## Usage

1. **Decorate your service classes with `[InjectService]`:**

```csharp
using RiseOn.AutoInject;

[InjectService(ServiceLifetimeType.Singleton)]
public class MySingletonService : IMyService
{
    // The ServiceLifetimeType is required, it can be Singleton, Scoped, or Transient.
}

[InjectService(ServiceLifetimeType.Singleton,  true)]
public class MySingletonService : IDisposable
{
    // The true parameter indicates that this class should be registered as a service without an implementation type.
    // This avoid registering interfaces or base classes that not be used as a service. e.g IDisposable interface.
}
```

2. **Register services in your application startup:**

```csharp
using Microsoft.Extensions.DependencyInjection;
using RiseOn.AutoInject;

[InjectService(ServiceLifetimeType.Singleton,
        CollectionName = "MyCollection")]
public class MySingletonService : IMyService
{
    // ...
}

var services = new ServiceCollection();

services.UseMyCollectionServices(); // Extension method to scan and register all attributed services

// If no definided the CollectionName, the default name is the root namespace of solution or AutoInjected.
services.UseAutoInjectServices(); // Extension method to scan and register all attributed services
```

## Advanced Usage
- Use `CollectionName` to group services.
- Use `ImplementationOf` to specify the interface or base class.
- Use `ServiceNamespace` to specify a namespace for the collection of services.
- Use the `Key` property for keyed registrations. (*.NET 8.0+*)

```csharp
[InjectService(ServiceLifetimeType.Transient,
        CollectionName = "MyCollection")]
public class MyTransientService : IMyService
{
    // The CollectionName is optional, it can be used to group services.
    //When used, the service will be registered as a extension class of the ServiceCollection with the name set in the collection name.
    // The default name is the root namespace of solution or AutoInjected.
}

[InjectService(ServiceLifetimeType.Scoped,
        ImplementationOf = typeof(IMyService))]
public class MyScopedService : IMyService, IMyOtherService
{
    // If you want to register a class as an implementation of a specific interface or base class, use the ImplementationOf property.
}

[InjectService(ServiceLifetimeType.Singleton,
        ServicesNamespace="RiseOn.AutoInject")]
public class MySingletonService : IMyService
{
    // The ServicesNamespace is optional, it can be used to specify a namespace for the collectiion of services.
}

[InjectService(ServiceLifetimeType.Scoped, Key = "SpecialKey")]
public class MyKeyedService : IMyService
{
    // It'll be createa da AddKeyedService with the key "SpecialKey".
}
```

## Source code generation
- The library uses source generators to create extension methods for each service collection.

```csharp
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by the RiseOn.AutoInject source generator
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using Microsoft.Extensions.DependencyInjection;

// namespace Sample.Services --> if defiened in the attribute

public static class SampleServicesCollectionExtensions
{
    public static IServiceCollection UseSampleServices(this IServiceCollection services)
    {
        services.AddSingleton<IMyService, MySingletonService>();
        services.AddScoped<IMyService, MyScopedService>();
        services.AddTransient<IMyService, MyTransientService>();
        services.AddKeyedSingleton<IMyService, MyKeyedService>( "MyKeyedService");
        return services;
    }
}
```

## Example
See the [ `samples/AutoInjectSamples/Program.cs`](../RiseOn.AutoInject/samples/AutoInjectSamples/Program.cs) for a working example.

## Contributing
Contributions are welcome! Please open issues or submit pull requests.

## License
This project is licensed under the MIT License.
